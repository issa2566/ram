@echo off
chcp 65001 > nul
cls

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo     ๐ง ุญู ูุดููุฉ "ูุดู ูู ุชุณุฌูู ุงูุฏุฎูู"
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

echo ๐ ุงูุฎุทูุฉ 1: ุฅููุงู ุฌููุน ุนูููุงุช Node.js ุงููุฏููุฉ...
taskkill /f /im node.exe >nul 2>&1
timeout /t 2 /nobreak > nul
echo โ ุชู
echo.

echo ๐ ุงูุฎุทูุฉ 2: ุงูุงูุชูุงู ููุฌูุฏ Backend...
cd /d "%~dp0backend"

if not exist "server.js" (
    echo โ ุฎุทุฃ: server.js ุบูุฑ ููุฌูุฏ!
    pause
    exit /b 1
)

echo โ server.js ููุฌูุฏ
echo.

echo ๐ฆ ุงูุฎุทูุฉ 3: ุชุซุจูุช ุงูููุชุจุงุช...
call npm install
echo โ ุชู
echo.

echo ๐ง ุงูุฎุทูุฉ 4: ุชุซุจูุช bcrypt...
call npm install bcrypt
echo โ ุชู
echo.

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo     ๐ ุชุดุฎูุต ูุดููุฉ PostgreSQL
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

echo ๐ก ูููุงุช ุงููุฑูุฑ ุงูุดุงุฆุนุฉ ูู PostgreSQL:
echo    1. postgres (ุงูุฃูุซุฑ ุดููุนุงู)
echo    2. admin
echo    3. password
echo    4. (ูุงุฑุบุฉ - ุงุถุบุท Enter ููุท)
echo.

echo ๐งช ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจู PostgreSQL...
psql -U postgres -c "SELECT version();" >nul 2>&1

if %ERRORLEVEL% EQU 0 (
    echo โ PostgreSQL ูุนูู ููููู ุงูุงุชุตุงู ุจู!
    echo.
    
    echo ๐ ุงูุชุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช testdb...
    psql -U postgres -c "SELECT datname FROM pg_database WHERE datname='testdb';" >nul 2>&1
    
    if %ERRORLEVEL% EQU 0 (
        echo โ ูุงุนุฏุฉ ุงูุจูุงูุงุช testdb ููุฌูุฏุฉ
    ) else (
        echo โ๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช testdb ุบูุฑ ููุฌูุฏุฉ
        echo ๐ ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช...
        psql -U postgres -c "CREATE DATABASE testdb;" >nul 2>&1
        
        if %ERRORLEVEL% EQU 0 (
            echo โ ุชู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช testdb
            
            echo ๐ ุฅูุดุงุก ุงูุฌุฏุงูู...
            psql -U postgres -d testdb -f database.sql >nul 2>&1
            
            if %ERRORLEVEL% EQU 0 (
                echo โ ุชู ุฅูุดุงุก ุงูุฌุฏุงูู ุจูุฌุงุญ
            ) else (
                echo โ๏ธ ุชุญุฐูุฑ: ูุฏ ุชููู ููุงู ูุดููุฉ ูู ุฅูุดุงุก ุงูุฌุฏุงูู
            )
        ) else (
            echo โ ูุดู ูู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
        )
    )
) else (
    echo โ ูุง ูููู ุงูุงุชุตุงู ุจู PostgreSQL
    echo.
    echo ๐ก ุงูุญููู ุงูููุชุฑุญุฉ:
    echo    1. ุชุฃูุฏ ูู ุชุดุบูู PostgreSQL
    echo    2. ุฌุฑุจ ูููุงุช ูุฑูุฑ ูุฎุชููุฉ ูู backend\db.js
    echo    3. ุงูุชุญ psql ูุฏููุงู ูุงุฎุชุจุฑ ุงูุงุชุตุงู
    echo.
    echo ๐ง ุชุนุฏูู ูููุฉ ุงููุฑูุฑ:
    echo    - ุงูุชุญ ููู: backend\db.js
    echo    - ุงูุณุทุฑ 8: password: 'ูููุฉ_ุงููุฑูุฑ_ุงูุตุญูุญุฉ'
    echo.
)

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo     ๐ ุชุดุบูู Backend
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

echo ๐ ุงูุฎุงุฏู ุณูุนูู ุนูู: http://localhost:3000
echo.
echo โ๏ธ ูุง ุชุบูู ูุฐู ุงููุงูุฐุฉ!
echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

node server.js

echo.
echo โ ุงูุฎุงุฏู ุชููู!
pause
